<div class="modal-header bg-primary modal-dragable">
    <button type="button" ng-click="close()" class="close"><i class="icons-office-52"></i></button>

    <h4 class="modal-title">
        <i class="fa fa-file"></i>
        批量挂接
    </h4>
</div>

<div class="modal-body ">

    <form name="FormMaintain" ng-show="currentStep == 1">
        <div class="row">
            <div class="col-lg-12">
                <fieldset class="m-0 p-t-5 " style="padding-bottom:5px;">
                    <legend>表达式</legend>
                    <div class="row">
                        <div class="col-sm-10 p-0">
                            <input ng-model="expressionStr" type="text" class="form-control form-white "
                                   name="expressionStr"
                                   ng-readonly="true" validator="required" />
                        </div>
                        <div class="col-sm-2 p-l-5 p-r-0">
                            <button type="button" class="btn btn-sm m-t-5 btn-primary btn-square width-100p"
                                    ng-click="clear()">
                                <i class="fa fa-close"></i>
                                清空
                            </button>
                        </div>
                    </div>
                </fieldset>

            </div>
        </div>

        <div class="row">
            <div class="col-md-6">

                <fieldset class="m-0 p-t-5 " style="padding-bottom:5px;">
                    <legend>字符串</legend>

                    <div class="row">

                        <div class="col-sm-8 p-0">
                            <input placeholder="填充" ng-model="info.Value" type="text" class="form-control form-white" />
                        </div>
                        <div class="col-sm-4 p-l-5 p-r-0">
                            <button type="button" class="btn btn-sm m-t-5 btn-primary btn-square width-100p"
                                    ng-click="addValue()">
                                <i class="fa fa-plus"></i>
                                添加
                            </button>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="p-t-5 m-t-5 " style="padding-bottom:5px;">
                    <legend>自动编号</legend>

                    <div class="row">
                        <div class="col-sm-6 p-0">
                            <input name="autoNumber.start" placeholder="起始值"
                                   ng-model="info.autoNumber.start" type="text"
                                   class="form-control form-white" validator="numberornull" />
                        </div>
                        <div class="col-sm-6 p-l-5 p-r-0">
                            <input name="autoNumber.length" placeholder="长度"
                                   ng-model="info.autoNumber.length" type="text"
                                   class="form-control form-white" validator="numberornull" />
                        </div>

                    </div>
                    <div class="row m-t-5">

                        <div class="col-sm-8 p-0">
                            <input placeholder="填充" ng-model="info.autoNumber.fill" type="text" class="form-control form-white" />
                        </div>
                        <div class="col-sm-4 p-l-5 p-r-0">
                            <button type="button" class="btn btn-sm m-t-5 btn-primary btn-square width-100p"
                                    ng-click="addAutoNumber()">
                                <i class="fa fa-plus"></i>
                                添加
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="col-md-6">
                <fieldset class="m-0 p-t-5 " style="padding-bottom:5px;">
                    <legend>字段</legend>
                    <div class="row">
                        <div class="col-sm-12 p-0">

                            <ui-select ng-model="info.DataField" theme="select2" search-enabled="false" class="form-control form-white">
                                <ui-select-match placeholder="选择字段">{{$select.selected.Name}}</ui-select-match>
                                <ui-select-choices repeat="item in fields">
                                    <div ng-bind-html="item.Name"></div>
                                </ui-select-choices>
                            </ui-select>

                        </div>

                    </div>
                    <div class="row m-t-10">
                        <div class="col-sm-12 p-0">
                            <input type="radio" value="1" name="fieldRegion" ng-model="result.FieldRegion" icheck />
                            <span>取全部值</span>
                            &nbsp;&nbsp;&nbsp;
                            <input type="radio" value="2" name="fieldRegion" ng-model="result.FieldRegion" icheck />
                            <span>取部分值</span>
                        </div>
                    </div>

                    <div class="row m-t-10">
                        <div class="col-sm-6 p-0">
                            <input name="fieldstart" placeholder="起始值"
                                   ng-model="info.field.start" type="text"
                                   class="form-control form-white" validator="numberornull" />
                        </div>
                        <div class="col-sm-6 p-l-5 p-r-0">
                            <input name="fieldlength" placeholder="长度"
                                   ng-model="info.field.length" type="text"
                                   class="form-control form-white" validator="numberornull" />
                        </div>

                    </div>

                    <div class="row m-t-10">

                        <div class="col-sm-8 p-0">
                            &nbsp;
                        </div>
                        <div class="col-sm-4 p-l-5 p-r-0">
                            <button type="button" class="btn btn-sm m-t-5 btn-primary btn-square width-100p"
                                    ng-click="addDataField()">
                                <i class="fa fa-plus"></i>
                                添加
                            </button>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <fieldset class="m-0">
                    <legend>文件匹配</legend>

                    <input type="radio" value="1" name="fileMatch" ng-model="result.FileMatch" icheck />
                    <span>完全</span>
                    &nbsp;&nbsp;&nbsp;
                    <input type="radio" value="2" name="fileMatch" ng-model="result.FileMatch" icheck />
                    <span>前缀</span>
                    &nbsp;&nbsp;&nbsp;
                    <input type="radio" value="3" name="fileMatch" ng-model="result.FileMatch" icheck />
                    <span>包含</span>
                </fieldset>
            </div>
        </div>
    </form>

    <form name="FormMaintain1" ng-show="currentStep == 2">
        <div class="row">

            <div class="col-sm-8">
                <button type="button" class="btn btn-primary btn-square "
                        pl-upload
                        pl-progress-model="percent"
                        pl-auto-upload="false"
                        pl-files-model="upAttachs"
                        pl-instance="myPLInstance"
                        on-file-added="fileAdded()"
                        on-file-uploaded="uploaded($response, $file)">
                    <i class="fa fa-file"></i>
                    上传文件
                </button>
                <button type="button" class="btn btn-primary btn-square "
                        ng-click="clearUpFiles()">
                    <i class="fa fa-close"></i>
                    清空文件
                </button>
            </div>
            <div class="col-sm-4">
                文件匹配: &nbsp;&nbsp; <label>{{upAttachs.length}} / {{allFileCount}} </label><br />
                上传进度: &nbsp;&nbsp; <label>{{percent.toFixed(2)}}%</label>
            </div>
        </div>
        
        <div class="row">
            <hr class="m-t-0 m-b-10" />
        </div>

        <div class="row bold bg-white m-b-10">
            <div class="col-sm-1 p-r-0">序号</div>
            <div class="col-sm-4 p-r-0">文件</div>
            <div class="col-sm-2 p-r-0">进度</div>
            <div class="col-sm-2 p-r-0">匹配数量</div>
            <div class="col-sm-2 p-r-0">挂接数量</div>
        </div>

        <div data-height="265" scroll="fileScroll" auto="true">
           
            <div class="row" ng-repeat="attach in upAttachs"
                 ng-repeat-end="fileScroll.init()">
                <span class="col-sm-1">{{$index + 1}} . &nbsp;</span>
                <div class="col-sm-4">{{attach.name}}</div>
                <div class="col-sm-2">{{attach.percent}}%</div>
                <div class="col-sm-2">{{attach.FileEntitys.length}}</div>
                <div class="col-sm-2">{{attach.Done}}</div>
            </div>
            <div class="row" ng-show="upAttachs.length == 0">
                <span class="col-sm-12 c-red">
                    无匹配文件，请重新设定表达式或者选择文件!
                </span>
            </div>
        </div>
    </form>
</div>

<div class="modal-footer bg-aero">
    <div ng-show="currentStep > 1">
        <button type="button"
                ng-click="subStep();"
                class="btn btn-primary btn-square pull-left">
            <i class="fa fa-chevron-circle-left"></i>
            上一步
        </button>

    </div>
    <div ng-show="currentStep == 2">
        <button type="button"
                ng-click="startUpload();"
                class="btn btn-primary btn-square ">
            挂&nbsp;接
            <i class="fa fa-arrow-up"></i>
        </button>
    </div>
    <div ng-show="currentStep == 1">
        <button type="button"
                ng-click="nextStep();"
                validation-submit="FormMaintain"
                class="btn btn-primary btn-square ">
            下一步
            <i class="fa fa-chevron-circle-right"></i>
        </button>
    </div>

</div>